<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>釣銭準備</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="max-w-2xl mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4 text-center">釣銭準備</h1>

    <div id="input-area" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6"></div>

    <button onclick="calculateShortage()" class="w-full bg-blue-500 text-white py-2 rounded mb-4">不足を計算する</button>
    <button onclick="adjustShortageWithWorker()" class="w-full bg-green-500 text-white py-2 rounded">調整 (Web Worker)</button>

    <div id="shortageResult" class="mt-6 bg-white p-4 rounded shadow whitespace-pre-wrap"></div>
    <div id="adjustmentResult" class="mt-6 bg-white p-4 rounded shadow whitespace-pre-wrap"></div>
    <div id="changeCollectionResult" class="mt-6 bg-white p-4 rounded shadow whitespace-pre-wrap"></div>
  </div>

  <script>
    // 金種と目標設定
    const denominations = [10000, 5000, 2000, 1000, 500, 100, 50, 10, 5, 1];
    const baseTargets = {
      10000: 0,
      5000: 15,
      2000: 0,
      1000: 42,
      500: 50,
      100: 100,
      50: 50,
      10: 100,
      5: 16,
      1: 20
    };

    // 入力フィールドの初期化
    const inputArea = document.getElementById("input-area");
    denominations.forEach(denom => {
      const wrapper = document.createElement("div");
      wrapper.className = "flex items-center space-x-2 min-w-0";
      wrapper.innerHTML = `
        <label class="w-20 font-medium">${denom}円</label>
        <input id="input${denom}" type="number" min="0" value="" class="flex-1 p-1 border rounded w-full" />
      `;
      inputArea.appendChild(wrapper);
    });

    // 不足金計算
    function calculateShortage() {
      const input = {};
      denominations.forEach(denom => {
        input[denom] = parseInt(document.getElementById(`input${denom}`).value || "0", 10);
      });

      let resultText = `【調整前不足金種】\n`;
      let total = 0;
      for (let denom of denominations) {
        const shortage = Math.max(0, baseTargets[denom] - input[denom]);
        if (shortage > 0) {
          resultText += `${denom}円×${shortage}枚 = ${denom * shortage}円\n`;
          total += denom * shortage;
        }
      }
      resultText += `合計　${total.toLocaleString()}円`;

      document.getElementById("shortageResult").innerText = resultText;
      document.getElementById("adjustmentResult").innerText = "";
      document.getElementById("changeCollectionResult").innerText = "";
    }

    // Web Workerを使った調整
    function adjustShortageWithWorker() {
      const input = {};
      denominations.forEach(denom => {
        input[denom] = parseInt(document.getElementById(`input${denom}`).value || "0", 10);
      });

      const worker = new Worker('./worker.js');
      worker.postMessage({ input, baseTargets });

      worker.onmessage = (event) => {
        const { shortageResultText, combinedResultText } = event.data;

        document.getElementById("adjustmentResult").innerText = shortageResultText;
        document.getElementById("changeCollectionResult").innerText = combinedResultText;
      };

      worker.onerror = (err) => {
        console.error("Worker error:", err.message);
        document.getElementById("adjustmentResult").innerText = "エラーが発生しました。";
      };
    }
  </script>
</body>
</html>
